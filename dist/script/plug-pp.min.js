/**
 * Plug++ 1.0.0 (compiled on 08/04/2014)
 * @copyright			Copyright (C) 2014 Evil-Co <http://www.evil-co.org>
 * @license			GNU Lesser General Public License <http://www.gnu.org/licenses/lgpl.txt>
 */

define("Plug++/ResourceURL",function(){"use strict";return"http://lordakkarin.github.io/PlugPP/dist/"}),define("Plug++/Version",function(){"use strict";return"1.0.0"}),define("Plug++/Core",["jquery","underscore","Plug++/Version","Plug++/API","Plug++/ResourceLoader","Plug++/dependency/Class"],function(a,b,c,d,e,f){"use strict";var g={UPDATE_CHECK:9e5},h={notificationVersion:null},i=null;return f.extend({options:{components:{autoWoot:!1,autoJoin:!1,moderator:{historyNotification:!0},notification:!1,desktopNotification:!1},autoWoot:{delay:0}},stylesheet:null,timers:{updateCheck:null},timeouts:{autoWoot:null},ui:null,user:null,init:function(){this.verifyAPI(),this.options=b.extend(this.options,JSON.parse(d.getStorage("options"))||{}),this.registerTimers(),this.registerEvents(),this.injectUI(),d.notifyChat("system","Loaded Plug++ v"+c,null),this.debug("Running as user "+d.getUser().username)},debug:function(a){console&&console.debug(a)},injectUI:function(){this.stylesheet=a('<link rel="stylesheet" type="text/css" href="'+e.get("style","plug-pp.min.css")+"?cache="+Math.floor(100*Math.random())+'" />'),a("head").append(this.stylesheet),a("body").append('<div id="plugPP"><ul id="plugPPNavigation"><li class="plug-pp-button"><a id="plugpp-autowoot" class="plug-pp-button-autowoot"></a></li><li class="plug-pp-button"><a id="plugpp-autojoin" class="plug-pp-button-autojoin"></a></li><li class="plug-pp-button"><a id="plugpp-notification" class="plug-pp-button-notification"></a></li><li class="plug-pp-button"><a id="plugpp-desktop-notification" class="plug-pp-button-desktop-notification"></a></li><li class="plug-pp-button"><a id="plugpp-moderator" class="plug-pp-button-moderator"></a></li></ul></div>'),this.ui=a("#plugPPNavigation"),d.hasPermission(null,d.getRole("bouncer"))||(a("#plugpp-moderator").addClass("disabled"),this.options.components.moderator.historyNotification=!1),d.isNotificationAvailable()||(a("#plugpp-desktop-notification").addClass("disabled"),this.options.components.desktopNotification=!1),this.options.components.autoWoot&&a("#plugpp-autowoot").addClass("enabled"),this.options.components.autoJoin&&a("#plugpp-autojoin").addClass("enabled"),this.options.components.notification&&a("#plugpp-notification").addClass("enabled"),this.options.components.desktopNotification&&a("#plugpp-desktop-notification").addClass("enabled"),this.options.components.moderator.historyNotification&&a("#plugpp-moderator").addClass("enabled"),a("#plugpp-autowoot").click(a.proxy(function(){a("#plugpp-autwoot").hasClass("disabled")||(this.options.components.autoWoot=!this.options.components.autoWoot,this.options.components.autoWoot?(a("#plugpp-autowoot").addClass("enabled"),0===d.getUser().vote&&d.votePositive()):a("#plugpp-autowoot").removeClass("enabled"),this.saveOptions())},this)),a("#plugpp-autojoin").click(a.proxy(function(){a("#plugpp-autojoin").hasClass("disabled")||(this.options.components.autoJoin=!this.options.components.autoJoin,this.options.components.autoJoin?(a("#plugpp-autojoin").addClass("enabled"),d.joinWaitList()):a("#plugpp-autojoin").removeClass("enabled"),this.saveOptions())},this)),a("#plugpp-notification").click(a.proxy(function(){a("#plugpp-notification").hasClass("disabled")||(this.options.components.notification=!this.options.components.notification,this.options.components.notification?a("#plugpp-notification").addClass("enabled"):a("#plugpp-notification").removeClass("enabled"),this.saveOptions())},this)),a("#plugpp-desktop-notification").click(a.proxy(function(){a("#plugpp-desktop-notification").hasClass("disabled")||(this.options.components.desktopNotification=!this.options.components.desktopNotification,this.options.components.desktopNotification?d.notifyRequestPermissions(function(){a("#plugpp-desktop-notification").addClass("enabled")},function(){a("#plugpp-desktop-notification").addClass("disabled")})||a("#plugpp-desktop-notification").addClass("disabled"):a("#plugpp-desktop-notification").removeClass("enabled"),this.saveOptions())},this)),a("#plugpp-moderator").click(a.proxy(function(){a("#plugpp-moderator").hasClass("disabled")||(this.options.components.moderator.historyNotification=!this.options.components.moderator.historyNotification,this.options.components.moderator.historyNotification?a("#plugpp-moderator").addClass("enabled"):a("#plugpp-moderator").removeClass("enabled"),this.saveOptions())},this))},onChat:function(a){"mention"===a.type&&this.options.components.desktopNotification&&d.notifyImportant("Mentioned by "+a.from,a.message,e.get("image","mention.png"))},onDjAdvance:function(b){if(this.options.components.autoWoot&&null!==b&&(null!==this.timeouts.autoWoot&&window.clearTimeout(this.timeouts.autoWoot),0===this.options.autoWoot.delay?(d.votePositive(),this.debug("AutoWoot!")):this.timeouts.autoWoot=window.setTimeout(a.proxy(function(){d.votePositive(),this.debug("AutoWoot!"),this.timeouts.autoWoot=null},this),this.options.autoWoot.delay)),this.options.components.autoJoin&&(null===b||null===b.dj||b.dj.id!==d.getUser().id)&&d.joinWaitList(),this.options.components.moderator.historyNotification&&null!==b){var c=d.getHistory();a(c).each(a.proxy(function(a,f){return 0===a?!0:b.media.id===f.id?(d.notifyChat("system","This song is already in the history ("+(a+1)+" out of "+c.length+'). <a href="javascript:window.PlugPP.skipHistoryTrack ('+a+"1, "+c.length+');">Click here to skip</a>'),this.options.components.desktopNotification&&d.notifyImportant("Song in History",b.dj.username+" is playing a song which has been played recently ("+(a+1)+" out of "+c.length+").",e.get("image","history.png")),!1):void 0},this))}},onHistoryUpdate:function(){(this.options.components.desktopNotification||this.options.components.notification)&&API.getNextMedia()&&API.getNextMedia().inHistory&&i!=API.getNextMedia().media.id&&(this.options.components.notification&&d.notify("Your queued track ("+API.getNextMedia().media.title+") has been played recently."),this.options.components.desktopNotification&&d.notifyImportant("History Notification","Your queued track ("+API.getNextMedia().media.title+") has been played recently.",e.get("image","history.png")),i=API.getNextMedia().media.id)},registerEvents:function(){d.registerEvent(API.DJ_ADVANCE,this.onDjAdvance,this),d.registerEvent(API.CHAT,this.onChat,this),d.registerEvent(API.HISTORY_UPDATE,this.onHistoryUpdate,this)},registerTimers:function(){this.updateCheck(),this.timers.updateCheck=window.setInterval(this.updateCheck,g.UPDATE_CHECK)},saveOptions:function(){d.setStorage("options",JSON.stringify(this.options))},shutdown:function(){d.notifyChat("system","Disabling Plug++ ...",null),this.saveOptions(),this.stylesheet&&this.stylesheet.remove(this.stylesheet),this.ui&&this.ui.remove(),this.unregisterTimers(),this.unregisterEvents(),requirejs.undef("Plug++/Core"),requirejs.undef("Plug++/API"),requirejs.undef("Plug++/ResourceLoader"),requirejs.undef("Plug++/ResourceURL"),delete window.PlugPP},skipHistoryTrack:function(a,b){var c=API.getDJ().username;d.moderateSkip(),d.sendChat("@"+c+" song was in history ("+a+" out of "+b+")")},unregisterEvents:function(){d.unregisterEvent(API.DJ_ADVANCE,this.onDjAdvance,this)},unregisterTimers:function(){window.clearInterval(this.timers.updateCheck)},updateCheck:function(){a.ajax(e.get("script","version.json"),{dataType:"jsonp",jsonpCallback:"version",success:a.proxy(function(a){a!==c&&h.notificationVersion!=a&&(d.notifyChat("system","Plug++ version "+a+" has been released."),h.notificationVersion=a)},this)})},verifyAPI:function(){if(void 0===window.API)throw"The plug.dj API is currently not available. Please try again later and verify that you are on the correct website.";if(!window.API.enabled)throw"The plug.dj API is not yet initialized. Please try again later.";console&&console.info("The plug.dj API seems to be enabled and healthy.")}})}),define("Plug++/API",["jquery","Plug++/ResourceLoader","Plug++/dependency/Context","Plug++/dependency/PopoutView"],function(a,b,c,d){"use strict";return{cleanMessage:function(a){var b=["span","div","table","tr","td","br","br/","strong","em","a"],c=/<\/?([a-z][a-z0-9]*)\b[\^>]*>/gi;return a.replace(c,function(a,c){return b.indexOf(c.toLowerCase())>-1?a:""})},clearChat:function(){(d._window?a(d._window.document).find("#chat-messages"):a("#chat-messages")).html("").scrollTop(0),this.notifyChat("system","The chat has been cleared.",null)},getHistory:function(){return API.getHistory()},getRole:function(a){return API.ROLE[a.toUpperCase()]},getStorage:function(a){return this.isStorageAvailable()?window.localStorage.getItem("pp-"+a):null},getUser:function(a){return API.getUser(a)},hasPermission:function(a,b){return API.hasPermission(a,b)},isNotificationAvailable:function(){return void 0!==window.Notification&&null!==window.Notification},isStorageAvailable:function(){try{return void 0!==window.localStorage&&null!==window.localStorage}catch(a){return!1}},joinWaitList:function(){void 0!==this.getUser().wlIndex&&this.getUser().wlIndex>-1||a("#dj-button").click()},moderateSkip:function(){API.moderateSkip()},notify:function(a,b){b||(b="icon-chat-system"),c.trigger("notify",b,a)},notifyChat:function(b,c,e){if(c){"string"!=typeof c&&(c=c.html()),c=this.cleanMessage(c);var f=d._window?a(d._window.document).find("#chat-messages"):a("#chat-messages"),g=f.scrollTop()>f[0].scrollHeight-f.height()-20,h=a("<div>").addClass(b||"update"),i=a("<span>").addClass("text").html(c);"system"===b?h.append('<i class="icon icon-chat-system"></i>'):i.css("color",(e||"d1d1d1").toRGB()),f.append(h.append(i)),g&&f.scrollTop(f[0].scrollHeight)}},notifyImportant:function(a,c,d){if(!this.isNotificationAvailable())return void this.notify(a+"<br />"+c,null);d||(d=b.get("image","notification.png"));new Notification(a,{body:c,icon:d})},notifyRequestPermissions:function(a,b){return this.isNotificationAvailable()?"granted"===Notification.permission?(a(),!0):("denied"!==Notification.permission&&Notification.requestPermission(function(c){void 0===Notification.permission&&(Notification.permission=c),"granted"===c&&void 0!==a&&null!==a&&a(),"denied"===c&&void 0!==b&&null!==b&&b()}),!0):!1},registerEvent:function(a,b,c){API.on(a,b,c)},sendChat:function(a){API.sendChat(a)},setStorage:function(a,b){window.localStorage.setItem("pp-"+a,b)},unregisterEvent:function(a,b,c){API.off(a,b,c)},votePositive:function(){a("#woot").click()}}}),define("Plug++/ResourceLoader",["Plug++/ResourceURL"],function(a){"use strict";return{get:function(a,b){return this.getBaseUrl()+a+"/"+b},getBaseUrl:function(){return a}}}),require(["jquery","Plug++/ResourceLoader"],function(a,b){"use strict";a.ajax(b.get("script","obfuscation.json"),{dataType:"jsonp",jsonpCallback:"obfuscationMapping",success:function(b){var c=!1;return a(b).each(function(a,b){return requirejs.defined(b.mapping)?void define("Plug++/dependency/"+b.name,[b.mapping],function(a){return a}):void(c=!0)}),c?void(API?API.chatLog("The Plug++ obfuscation mappings have not been updated yet. Please report this error at https://github.com/LordAkkarin/PlugPP/issues"):console&&console.info("The Plug++ obfuscation mappings have not been updated yet. Please report this error at https://github.com/LordAkkarin/PlugPP/issues")):void require(["Plug++/Core"],function(a){void 0!==window.PlugPP&&(console&&console.info("Unloading old Plug++ instance ..."),window.PlugPP.shutdown()),window.PlugPP=new a})},error:function(a,b,c){console.error("Whoops: "+b+"; "+c)}})});
//# sourceMappingURL=plug-pp.min.map